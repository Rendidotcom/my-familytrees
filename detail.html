<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Detail Anggota</title>
<style>
body {
  font-family: Arial;
  background: #eef1f5;
  display: flex;
  justify-content: center;
}
.box {
  background: white;
  padding: 20px;
  margin-top: 40px;
  width: 90%;
  max-width: 400px;
  border-radius: 15px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}
img {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  object-fit: cover;
  margin: auto;
  display: block;
}
button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}
.btn-edit { background: #4A90E2; color: white; }
.btn-delete { background: #e74c3c; color: white; }
.btn-back { background: #7f8c8d; color: white; }
p { margin: 5px 0; }
</style>
</head>
<body>

<div class="box">
  <div id="content">Memuat...</div>

  <button class="btn-edit" id="editBtn">Edit</button>
  <button class="btn-delete" id="deleteBtn">Hapus</button>
  <button class="btn-back" onclick="history.back()">Kembali</button>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzRg74Zyz9ox0gy0se3CS_QWWzkzmJyUk2524KO6C0zAARDO1f5pj4w75dXAr8RoP7LzA/exec";
const id = new URLSearchParams(window.location.search).get("id");

// ===============================
// MUAT DETAIL DARI GAS
// ===============================
async function loadDetail() {
  const content = document.getElementById("content");
  content.innerHTML = "⏳ Memuat data...";

  try {
    const res = await fetch(`${API_URL}?mode=getData`);
    const json = await res.json();

    const data = json.data || [];
    const item = data.find(p => p.id === id);

    if (!item) {
      content.innerHTML = "Data tidak ditemukan.";
      return;
    }

    const photo = item.photoURL
      ? convertDriveURL(item.photoURL)
      : "https://via.placeholder.com/120";

    content.innerHTML = `
      <img src="${photo}" alt="${item.name}">
      <h3 style="text-align:center;">${item.name}</h3>
      <p><b>Domisili:</b> ${item.domisili || '-'}</p>
      <p><b>Hubungan:</b> ${item.relationship || '-'}</p>
      <p><b>Catatan:</b> ${item.notes || '-'}</p>
      <p><b>ID Ayah:</b> ${item.parentIdAyah || '-'}</p>
      <p><b>ID Ibu:</b> ${item.parentIdIbu || '-'}</p>
      <p><b>ID Pasangan:</b> ${item.spouseId || '-'}</p>
    `;

    document.getElementById("editBtn").onclick = () => {
      window.location = `edit.html?id=${id}`;
    };

  } catch (err) {
    console.error("Error:", err);
    content.innerHTML = "❌ Gagal memuat data.";
  }
}

// ===============================
// KONVERSI URL GOOGLE DRIVE
// ===============================
function convertDriveURL(url) {
  if (!url) return "https://via.placeholder.com/120";
  if (url.includes("drive.google.com")) {
    const id = url.match(/[-\w]{25,}/)?.[0];
    return id ? `https://drive.google.com/uc?export=view&id=${id}` : url;
  }
  return url;
}

// ===============================
// HAPUS DATA
// ===============================
document.getElementById("deleteBtn").onclick = async () => {
  if (!confirm("Yakin ingin menghapus anggota ini?")) return;

  try {
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ mode: "delete", id })
    });

    const json = await res.json();
    alert(json.message || "Berhasil dihapus!");
    window.location = "dashboard.html";
  } catch (err) {
    console.error(err);
    alert("Gagal menghapus data.");
  }
};

// ===============================
// INISIALISASI
// ===============================
document.addEventListener("DOMContentLoaded", loadDetail);
</script>

</body>
</html>
