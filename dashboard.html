<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Anggota Keluarga</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #eef1f5;
  margin: 0;
  padding: 0;
}

h2 {
  text-align: center;
  padding: 20px;
  color: #333;
}

#list {
  width: 90%;
  max-width: 900px;
  margin: 20px auto;
  background: white;
  padding: 20px;
  border-radius: 15px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.10);
}

.member {
  display: flex;
  align-items: flex-start;
  padding: 14px 10px;
  border-bottom: 1px solid #ddd;
}

.member:last-child {
  border-bottom: none;
}

.member img {
  width: 70px;
  height: 70px;
  border-radius: 50%;
  object-fit: cover;
  margin-right: 18px;
  border: 2px solid #ccc;
}

.member-info {
  flex: 1;
}

.member-info h4 {
  margin: 0;
  color: #333;
  font-size: 17px;
}

.member-info p {
  margin: 3px 0;
  font-size: 13px;
  color: #555;
  line-height: 1.4;
}

.member-buttons {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.member-buttons button {
  padding: 6px 10px;
  font-size: 12px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
}

.btn-edit { background: #27ae60; color: white; }
.btn-del  { background: #e74c3c; color: white; }

.empty {
  text-align: center;
  padding: 20px;
  color: #777;
}
</style>
</head>

<body>

<h2>ðŸ“‹ Daftar Anggota Keluarga</h2>
<div id="list">Memuat data...</div>

<script>
// =======================
// URL Google Apps Script FINAL
// =======================
const API_URL = "https://script.google.com/macros/s/AKfycbzRg74Zyz9ox0gy0se3CS_QWWzkzmJyUk2524KO6C0zAARDO1f5pj4w75dXAr8RoP7LzA/exec";

// =======================
// Fungsi bantu
// =======================
function convertDriveURL(url) {
  if (!url) return "https://via.placeholder.com/70";
  if (url.includes("drive.google.com")) {
    const id = url.match(/\/d\/(.*?)\//)?.[1];
    return id ? `https://drive.google.com/uc?export=view&id=${id}` : url;
  }
  return url;
}

// =======================
// LOAD DATA
// =======================
async function loadData() {
  const list = document.getElementById("list");
  list.innerHTML = "Memuat data...";

  try {
    // Ambil data dari GAS baru
    const res = await fetch(API_URL + "?mode=getData");
    const json = await res.json();
    console.log("DATA:", json);

    // Debug opsional di tablet
    // alert("Cek JSON: " + JSON.stringify(json).substring(0, 200));

    const data = json.data || [];
    if (!data.length) {
      list.innerHTML = `<div class="empty">Belum ada data</div>`;
      return;
    }

    // Peta ID â†’ data anggota
    const idMap = {};
    data.forEach(p =>
