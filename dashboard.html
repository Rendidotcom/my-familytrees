<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Dashboard Anggota</title>
<style>
body{font-family:Arial;background:#eef1f5;margin:0;padding:0}
nav{position:fixed;top:0;width:100%;background:#3498db;padding:12px;display:flex;justify-content:space-around;color:#fff}
.container{margin-top:80px;padding:18px}
.card{
 background:#fff;padding:14px;margin-bottom:12px;border-radius:10px;
 box-shadow:0 4px 10px rgba(0,0,0,0.05);
 display:flex;align-items:center;justify-content:space-between;
}
.card img{width:50px;height:50px;border-radius:50%;object-fit:cover;margin-right:12px}
.info{flex:1}
.name{font-weight:bold;font-size:16px}
.sub{font-size:13px;color:#666}
.btn{padding:6px 10px;border:0;border-radius:6px;cursor:pointer;font-size:13px}
.edit{background:#f1c40f;color:#000}
.delete{background:#e74c3c;color:#fff;margin-left:4px}
.sync{background:#2ecc71;color:#fff;width:100%;margin-bottom:12px;padding:10px;font-size:15px}
</style>
</head>
<body>

<nav>
  <a href="dashboard.html">ğŸ“‹ Dashboard</a>
  <a href="index.html">â• Tambah</a>
  <a href="tree.html">ğŸŒ³ Tree</a>
  <a href="#" onclick="logout()">ğŸšª Logout</a>
</nav>

<div class="container">
  <button class="sync" onclick="loadData()">ğŸ”„ Sync Data</button>
  <div id="list">Memuat data...</div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycby8WX2QXb_mc0lfP6AaAFqRNDIMyRkznr7o16zLU3BG9wV39uBG_qwDrxuIHOCbnrlBkw/exec";

const session = JSON.parse(localStorage.getItem('familyUser') || 'null');
if(!session || !session.id){
  alert("âš  Harap login dulu.");
  location.href = "login.html";
}

// ===== LOAD DATA =====
async function loadData(){
  document.getElementById("list").innerHTML = "â³ Loading...";
  try{
    const res = await fetch(`${API_URL}?mode=getData&nocache=${Date.now()}`);
    const j = await res.json();

    if(j.status !== "success"){
      document.getElementById("list").innerHTML = "âŒ Gagal memuat data";
      return;
    }

    renderList(j.data);
  }catch(err){
    document.getElementById("list").innerHTML = "âŒ Error: "+err.message;
  }
}

function renderList(data){
  const list = document.getElementById("list");
  if(!data.length){
    list.innerHTML = "ğŸ“­ Belum ada data.";
    return;
  }

  list.innerHTML = "";

  data.forEach(p=>{
    list.innerHTML += `
      <div class="card">
        <img src="${p.photo || 'https://via.placeholder.com/80'}">
        <div class="info">
          <div class="name">${p.name}</div>
          <div class="sub">${p.relationship || ''} â€¢ ${p.domisili || ''}</div>
        </div>
        <div>
          <button class="btn" style="background:#2980b9;color:white" onclick="viewDetail('${p.id}')">ğŸ‘ï¸</button>
          <button class="btn edit" onclick="editMember('${p.id}')">âœï¸</button>
          <button class="btn delete" onclick="deleteMember('${p.id}')">ğŸ—‘</button>
        </div>
      </div>
    `;
  });
}

// ===== EDIT =====
function editMember(id){
  location.href = `edit.html?id=${id}`;
}

// ===== DELETE =====
async function deleteMember(id){
  if(!confirm("âš  Yakin ingin menghapus anggota ini?")) return;

  try{
    const res = await fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({ mode:"delete", id })
    });
    const j = await res.json();

    if(j.status === "success"){
      alert("âœ” Data berhasil dihapus");
      loadData();
    } else {
      alert("âŒ Gagal: "+j.message);
    }
  }catch(err){
    alert("âŒ Error: "+err.message);
  }
}

// ===== LOGOUT =====
function logout(){
  localStorage.removeItem('familyUser');
  location.href = "login.html";
}

loadData();
</script>
</body>
</html>
