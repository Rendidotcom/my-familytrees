<!DOCTYPE html>

<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Family Tree Admin â€” Insert</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

  <!-- WAJIB: config.js -->

  <script src="config.js"></script>

  <style>
    body{background:#f4f7fa}
    .card{max-width:900px;margin:auto}
    pre{white-space:pre-wrap}
  </style>

</head>
<body>

<nav class="navbar navbar-dark bg-primary">
  <div class="container-fluid">
    <span class="navbar-brand">ðŸŒ³ Family Tree â€” Insert Member</span>
  </div>
</nav>

<div class="container py-4">
  <div class="card shadow p-4">
    <h4 class="mb-3">Tambah Anggota Baru</h4>

```
<div class="mb-3">
  <label>Token Admin</label>
  <input id="token" class="form-control" placeholder="token hasil login">
</div>

<div class="mb-3">
  <label>Nama</label>
  <input id="name" class="form-control">
</div>

<div class="mb-3">
  <label>Domisili</label>
  <input id="domisili" class="form-control">
</div>

<div class="mb-3">
  <label>Relationship</label>
  <input id="relationship" class="form-control">
</div>

<div class="row">
  <div class="col-md-4 mb-3">
    <label>ID Ayah</label>
    <input id="parentIdAyah" class="form-control">
  </div>
  <div class="col-md-4 mb-3">
    <label>ID Ibu</label>
    <input id="parentIdIbu" class="form-control">
  </div>
  <div class="col-md-4 mb-3">
    <label>ID Pasangan</label>
    <input id="spouseId" class="form-control">
  </div>
</div>

<div class="row">
  <div class="col-md-4 mb-3">
    <label>Urutan Anak</label>
    <input id="orderChild" class="form-control">
  </div>
  <div class="col-md-4 mb-3">
    <label>Status</label>
    <select id="status" class="form-control">
      <option value="active">active</option>
      <option value="deleted">deleted</option>
    </select>
  </div>
  <div class="col-md-4 mb-3">
    <label>Role</label>
    <select id="role" class="form-control">
      <option value="user">user</option>
      <option value="admin">admin</option>
    </select>
  </div>
</div>

<div class="mb-3">
  <label>Catatan</label>
  <textarea id="notes" class="form-control"></textarea>
</div>

<div class="mb-3">
  <label>Foto (opsional)</label>
  <input type="file" id="photo" class="form-control" accept="image/*">
</div>

<button class="btn btn-success" onclick="submitInsert()">ðŸš€ Insert Data</button>

<pre id="result" class="mt-3 bg-dark text-light p-3 rounded">Menunggu inputâ€¦</pre>
```

  </div>
</div>

<script>
const API_URL = window.API_URL;

function toBase64(file){
  return new Promise((resolve,reject)=>{
    const reader = new FileReader();
    reader.onload = ()=>resolve(reader.result.split(',')[1]);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

async function submitInsert(){
  const out = document.getElementById('result');
  out.textContent = 'Mengirim...';

  let photoBase64 = '';
  let photoType = '';

  const file = document.getElementById('photo').files[0];
  if(file){
    photoBase64 = await toBase64(file);
    photoType = file.type;
  }

  // === FORM-URLENCODED (NO CORS PREFLIGHT) ===
  const payload = new URLSearchParams();
  payload.append('mode','insert');
  payload.append('token', document.getElementById('token').value.trim());

  payload.append('name', document.getElementById('name').value.trim());
  payload.append('domisili', document.getElementById('domisili').value.trim());
  payload.append('relationship', document.getElementById('relationship').value.trim());
  payload.append('notes', document.getElementById('notes').value.trim());
  payload.append('parentIdAyah', document.getElementById('parentIdAyah').value.trim());
  payload.append('parentIdIbu', document.getElementById('parentIdIbu').value.trim());
  payload.append('spouseId', document.getElementById('spouseId').value.trim());
  payload.append('orderChild', document.getElementById('orderChild').value.trim());
  payload.append('status', document.getElementById('status').value);
  payload.append('role', document.getElementById('role').value);

  // === FOTO (sinkron code.gs) ===
  payload.append('photo_base64', photoBase64);
  payload.append('photo_type', photoType);

  try{
    const r = await fetch(API_URL, {
      method: 'POST',
      body: payload
    });

    const txt = await r.text();
    out.textContent = txt;
  }catch(err){
    out.textContent = 'ERROR fetch: ' + err;
  }
}
</script>

</body>
</html>
