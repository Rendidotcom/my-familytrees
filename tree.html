<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸŒ³ Family Tree</title>
<style>
body{font-family:Arial;background:#eef1f5;text-align:center;margin:0;padding:0;}
nav{width:100%;background:#3498db;padding:12px;color:white;display:flex;justify-content:space-around;position:sticky;top:0;font-weight:bold;}
nav a{color:white;text-decoration:none;}
.toolbar{margin-top:10px;}
button{margin:5px;padding:10px 14px;border:none;border-radius:6px;cursor:pointer;background:#34495e;color:white;font-size:14px;}
button:hover{opacity:.85;}
#treeContainer{margin:25px auto;width:95%;min-height:300px;background:white;padding:20px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.1);}
.person{display:inline-block;text-align:center;margin:10px;}
.person img{width:70px;height:70px;border-radius:50%;object-fit:cover;border:3px solid #ccc;}
.dead{opacity:0.45;filter:grayscale(1);}
</style>
</head>
<body>
<nav>
<a href="dashboard.html">ğŸ“‹ Dashboard</a>
<a href="index.html">â• Tambah</a>
<a href="#" onclick="logout()">ğŸšª Logout</a>
</nav>
<h2>ğŸŒ³ Family Tree</h2>
<div class="toolbar">
<button onclick="toggleStatus('all')">ğŸ‘€ Tampilkan Semua</button>
<button onclick="toggleStatus('alive')">ğŸŸ¢ Yang Hidup</button>
<button onclick="toggleStatus('dead')">âš« Yang Meninggal</button>
</div>
<div id="treeContainer">â³ Memuat data...</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbzRvMj-bFP08nZMXK1rEnAX7ZvOd46OK-r1bZ4ugT-2rV8vs9VpI1G_APZMJ-3AgBXlRw/exec";
const session=JSON.parse(localStorage.getItem("familyUser")||"null");
if(!session){ alert("âš  Harus login"); window.location.href="login.html"; }

let members=[];
async function loadTree(){
  const box=document.getElementById("treeContainer");
  box.innerHTML="â³ Memuat data...";
  const res=await fetch(API_URL+"?mode=getData&nocache="+Date.now());
  const json=await res.json();
  members=json.data||[];
  renderTree();
}
function getPhoto(url){ if(!url) return "https://via.placeholder.com/70"; const id=url.match(/[-\w]{25,}/)?.[0]; return `https://drive.google.com/uc?export=view&id=${id}`; }
function renderTree(filter="all"){
  const box=document.getElementById("treeContainer");
  box.innerHTML="";
  members.forEach(p=>{
    if(filter==="alive"&&p.status==="meninggal")return;
    if(filter==="dead"&&p.status!=="meninggal")return;
    const div=document.createElement("div");
    div.className="person "+(p.status==="meninggal"?"dead":"");
    div.innerHTML=`<img src="${getPhoto(p.photoURL)}"><div>${p.name}</div>`;
    box.appendChild(div);
  });
}
function toggleStatus(mode){ renderTree(mode); }
function logout(){ localStorage.removeItem("familyUser"); window.location.href="login.html"; }
loadTree();
</script>
</body>
</html>
