<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Family Tree</title>
<style>
body{font-family:Arial;background:#eef1f5;margin:0;padding:0;text-align:center}
nav{background:#3498db;padding:12px;color:#fff;display:flex;justify-content:space-around;position:sticky;top:0}
nav a{color:#fff;text-decoration:none}
.toolbar{margin:12px}
#treeContainer{width:95%;max-width:1100px;margin:18px auto;background:#fff;padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.06);display:flex;flex-wrap:wrap;justify-content:center}
.person{margin:10px;text-align:center}
.person img{width:70px;height:70px;border-radius:50%;object-fit:cover;border:3px solid #ddd}
.dead{opacity:0.45;filter:grayscale(1)}
button{padding:8px 12px;border-radius:8px;border:0;background:#34495e;color:#fff;cursor:pointer;margin:6px}
</style>
</head>
<body>
<nav>
  <a href="dashboard.html">ğŸ“‹ Dashboard</a>
  <a href="index.html">â• Tambah</a>
  <a href="#" onclick="logout()">ğŸšª Logout</a>
</nav>

<h2 style="margin-top:14px">ğŸŒ³ Family Tree</h2>
<div class="toolbar">
  <button onclick="renderTree('all')">ğŸ‘€ Semua</button>
  <button onclick="renderTree('alive')">ğŸŸ¢ Hidup</button>
  <button onclick="renderTree('dead')">âš« Meninggal</button>
</div>

<div id="treeContainer">â³ Memuat...</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycby8WX2QXb_mc0lfP6AaAFqRNDIMyRkznr7o16zLU3BG9wV39uBG_qwDrxuIHOCbnrlBkw/exec";
const session = JSON.parse(localStorage.getItem('familyUser') || 'null');
if(!session || !session.id) { alert('âš  Harap login'); location.href='login.html' }
let members = [];

function getPhoto(url){ if(!url) return 'https://via.placeholder.com/70'; const id = url.match(/[-\w]{25,}/)?.[0]; return id?`https://drive.google.com/uc?export=view&id=${id}`:url; }

async function load(){
  const c = document.getElementById('treeContainer');
  c.innerHTML = 'â³ Memuat...';
  try{
    const res = await fetch(`${API_URL}?mode=getData&nocache=${Date.now()}`);
    const j = await res.json();
    members = j.data || [];
    renderTree('all');
  }catch(err){ document.getElementById('treeContainer').innerText = 'âŒ Error: '+err.message; console.error(err); }
}

function renderTree(filter='all'){
  const c = document.getElementById('treeContainer');
  c.innerHTML = '';
  const filtered = members.filter(p=>{
    if(filter==='alive') return p.status !== 'meninggal';
    if(filter==='dead') return p.status === 'meninggal';
    return true;
  });
  if(filtered.length === 0){ c.innerHTML = '<div class="small">Tidak ada anggota</div>'; return; }
  for(const p of filtered){
    const div = document.createElement('div');
    div.className = 'person ' + (p.status==='meninggal'?'dead':'');
    div.innerHTML = `<img src="${getPhoto(p.photoURL)}" alt="${p.name}"><div style="margin-top:6px">${p.name}</div><div style="font-size:13px;color:#666">${p.relationship||''}</div>`;
    c.appendChild(div);
  }
}

function logout(){ localStorage.removeItem('familyUser'); location.href='login.html'; }

load();
</script>
</body>
</html>
